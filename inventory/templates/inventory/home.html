{% extends 'base.html' %}
{% load static %}
{% block extra_css %}
<style>
    :root {
        --primary-color: #0d6efd;
        --secondary-color: #ff6b35;
        --accent-color: #ffcc00;
        --dark-color: #1a1a2e;
        --light-color: #f8f9fa;
        --success-color: #28a745;
        --diwali-gold: #ffd700;
        --diwali-deep-gold: #ffb347;
        --diwali-red: #b30000;
        --diwali-orange: #ff8c00;
        --diwali-green: #228b22;
        --diwali-blue: #1a1a2e;
        --diwali-purple: #4b0082;
        --diwali-pink: #ff69b4;
    }

    body {
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
        min-height: 100vh;
        overflow-x: hidden;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    /* ðŸ”¶ KANNAN STYLE ORDER HEADER (TOP TEXT + SUMMARY STRIP) */
    .order-sale-banner {
        text-align: center;
        margin-top: 30px;
        margin-bottom: 10px;
        color: #ff0000;
        font-weight: 700;
        font-size: 1.3rem;
    }

    .order-summary-strip {
        background: #ff9800;
        color: #fff;
        padding: 10px 15px;
        border-radius: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 10px;
        flex-wrap: wrap;
        box-shadow: 0 4px 12px rgba(0,0,0,0.25);
        margin-bottom: 25px;
        font-size: 0.95rem;
    }

    .order-summary-strip span.label {
        font-weight: 600;
    }

    .order-summary-strip span.value {
        font-weight: 700;
        font-size: 1rem;
    }

    .order-summary-strip .btn-clear-all {
        background: #ffeb3b;
        color: #c62828;
        font-weight: 700;
        border-radius: 20px;
        border: none;
        padding: 6px 14px;
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 0.9rem;
        box-shadow: 0 3px 8px rgba(0,0,0,0.3);
        white-space: nowrap;
    }

    .order-summary-strip .btn-clear-all i {
        font-size: 1rem;
    }

    /* ðŸ”¶ CATEGORY SECTION TITLE BAR (orange strip like Kannan) */
    .category-section {
        margin-bottom: 40px;
    }

    .category-title-bar {
        background: var(--kannan-orange);
        color: #ffffff;
        text-align: center;
        font-weight: 700;
        font-size: 1rem;
        padding: 10px 8px;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        border-radius: 4px 4px 0 0;
    }

    /* ðŸ”¶ TABLE WRAPPER */
    .order-table-wrapper {
        border-radius: 0 0 4px 4px;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0,0,0,0.25);
    }

    .kannan-order-table {
        width: 100%;
        border-collapse: collapse;
        table-layout: fixed;
    }

    .kannan-order-table th,
    .kannan-order-table td {
        border: 1px solid #ffffff;
        padding: 10px 8px;
        font-size: 0.9rem;
        text-align: center;
    }

    .kannan-order-table thead th {
        background: var(--kannan-header-bg);
        color: #ffffff;
        font-weight: 700;
    }

    .kannan-order-table tbody td {
        background: var(--kannan-purple);
        color: #ffffff;
        vertical-align: middle;
    }

    .kannan-order-table tbody tr:nth-child(even) td {
        background: var(--kannan-purple-dark);
    }

    .kannan-order-table .sno-col {
        width: 60px;
        font-weight: 700;
    }

    .kannan-order-table .img-col {
        width: 90px;
    }

    .kannan-order-table .img-col img {
        max-width: 70px;
        max-height: 80px;
        object-fit: cover;
        display: block;
        margin: 0 auto;
    }

    .kannan-order-table .name-col {
        text-align: left;
        font-weight: 700;
        font-size: 0.95rem;
    }

    .kannan-order-table .content-col {
        width: 90px;
        font-weight: 700;
        color: #ffeb3b;
    }

    .kannan-order-table .money-col {
        width: 110px;
        font-weight: 700;
    }

    .kannan-order-table .money-col .mrp-val,
    .kannan-order-table .money-col .discount-val,
    .kannan-order-table .money-col .amount-val {
        display: inline-block;
        min-width: 50px;
        text-align: right;
    }

    .kannan-order-table .money-col.mrp {
        color: #ffb3ff;
    }

    .kannan-order-table .money-col.discount {
        color: #ff5252;
    }

    .kannan-order-table .money-col.amount {
        color: #00e676;
    }

    .kannan-order-table .qty-col {
        width: 90px;
    }

    .qty-input {
        width: 70px;
        padding: 4px 6px;
        border-radius: 6px;
        border: none;
        text-align: center;
        font-weight: 600;
        color: #000000;
    }

    .kannan-order-table .total-col {
        width: 110px;
        background:  #000000;
        color: #ffffff;
        font-weight: 700;
    }

    .kannan-order-table .total-col .row-total-val {
        display: inline-block;
        min-width: 60px;
        text-align: right;
    }

    /* RESPONSIVE */
    @media (max-width: 992px) {
        .order-summary-strip {
            flex-direction: column;
            align-items: flex-start;
        }

        .order-summary-strip > div {
            width: 100%;
            display: flex;
            justify-content: space-between;
        }

        .order-summary-strip .btn-clear-all {
            align-self: flex-end;
        }

        .kannan-order-table th,
        .kannan-order-table td {
            padding: 8px 6px;
            font-size: 0.8rem;
        }

        .kannan-order-table .img-col {
            width: 60px;
        }

        .kannan-order-table .img-col img {
            max-width: 50px;
            max-height: 60px;
        }

        .kannan-order-table .name-col {
            font-size: 0.85rem;
        }
    }

    @media (max-width: 576px) {
        .order-sale-banner {
            font-size: 1.1rem;
            padding: 0 10px;
        }

        .order-summary-strip {
            font-size: 0.8rem;
        }

        .order-summary-strip .btn-clear-all {
            width: 100%;
            justify-content: center;
        }
    }



    /* -------------------- ðŸŒŸ FESTIVE FIREWORKS BACKGROUND -------------------- */
    .crackers-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        overflow: hidden;
        pointer-events: none;
    }

    .cracker {
        position: absolute;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        pointer-events: none;
        opacity: 0;
    }

    .cracker::before {
        content: '';
        position: absolute;
        width: 100%;
        height: 100%;
        border-radius: 50%;
        background: radial-gradient(circle, #ffcc00, #ff6b35, #ff0000);
        animation: cracker-explode 1.8s ease-out forwards;
    }

    @keyframes cracker-explode {
        0% { transform: scale(0); opacity: 1; }
        50% { transform: scale(2); opacity: 1; }
        100% { transform: scale(5); opacity: 0; }
    }

    .spark {
        position: absolute;
        width: 4px;
        height: 4px;
        border-radius: 50%;
        background: #ffcc00;
        box-shadow: 0 0 10px 2px #ffcc00;
        opacity: 0;
        animation: spark-fall 2s ease-out forwards;
    }

    @keyframes spark-fall {
        0% { transform: translateY(0); opacity: 1; }
        100% { transform: translateY(100px); opacity: 0; }
    }

    /* -------------------- ðŸª” DIWALI GLOW BAR -------------------- */
    .diwali-bar {
        text-align: center;
        padding: 10px 0;
        background: linear-gradient(90deg, #ff8c00, #ffd700, #ff6b35);
        color: #1a1a2e;
        font-weight: 700;
        font-size: 1.1rem;
        letter-spacing: 0.5px;
        box-shadow: 0 3px 10px rgba(255, 215, 0, 0.5);
        position: sticky;
        top: 0;
        z-index: 1000;
        animation: glowPulse 3s infinite ease-in-out;
    }

    @keyframes glowPulse {
        0%, 100% { box-shadow: 0 0 10px #ffd700; }
        50% { box-shadow: 0 0 30px #ff8c00; }
    }

    /* -------------------- ðŸŽ‡ PAGE HEADER -------------------- */
    .page-header {
        text-align: center;
        margin-top: 50px;
        margin-bottom: 50px;
    }

    .page-title {
        background: linear-gradient(135deg, var(--accent-color), var(--secondary-color));
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        font-size: 3rem;
        font-weight: 800;
        text-shadow: 0 2px 15px rgba(0, 0, 0, 0.3);
    }

    .page-subtitle {
        color: rgba(255, 255, 255, 0.8);
        font-size: 1.2rem;
    }

    /* -------------------- ðŸ§¨ PRODUCT CARDS -------------------- */
    .product-card {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: all 0.4s ease;
        display: flex;
        flex-direction: column;
    }

    .product-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4);
    }

    .card-image-container {
        position: relative;
        height: 200px;
        overflow: hidden;
    }

    .card-img-top {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.5s ease;
    }

    .product-card:hover .card-img-top {
        transform: scale(1.1);
    }

    .product-badge {
        position: absolute;
        top: 15px;
        right: 15px;
        background: linear-gradient(135deg, var(--accent-color), var(--secondary-color));
        color: #fff;
        padding: 8px 15px;
        border-radius: 50px;
        font-weight: 600;
        font-size: 0.8rem;
        box-shadow: 0 4px 15px rgba(255, 107, 53, 0.4);
    }

    .low-stock-badge {
        background: linear-gradient(135deg, #dc3545, #c82333);
    }

    .card-body {
        padding: 20px;
        flex-grow: 1;
    }

    .card-title {
        font-size: 1.3rem;
        font-weight: 700;
        color: #1a1a2e;
    }

    .price-stock-info {
        display: flex;
        justify-content: space-between;
        margin-top: 10px;
        font-weight: 600;
    }

    .price {
        color: var(--primary-color);
        font-size: 1.3rem;
    }

    .stock-info.text-danger {
        color: #dc3545 !important;
        animation: shake 0.5s ease-in-out;
    }

    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-3px); }
        75% { transform: translateX(3px); }
    }

    /* -------------------- ðŸ›’ CART + CHECKOUT STYLES -------------------- */
    .floating-cart {
        position: fixed;
        bottom: 30px;
        right: 30px;
        background: linear-gradient(135deg, var(--accent-color), var(--secondary-color));
        color: white;
        padding: 15px 20px;
        border-radius: 50px;
        box-shadow: 0 10px 30px rgba(255, 107, 53, 0.4);
        cursor: pointer;
        z-index: 1000;
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: 600;
        animation: bounce 2s infinite;
    }

    @keyframes bounce {
        0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
        40% { transform: translateY(-10px); }
        60% { transform: translateY(-5px); }
    }

    .cart-items-count {
        font-size: 0.9rem;
        opacity: 0.9;
    }

    /* -------------------- ðŸª” DIWALI SUCCESS OVERLAY -------------------- */
    .diwali-success-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(26, 26, 46, 0.95);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.6s ease;
    }

    .diwali-success-overlay.active {
        opacity: 1;
        pointer-events: auto;
    }

    .diwali-message-box {
        background: rgba(255, 255, 255, 0.98);
        border-radius: 20px;
        padding: 40px;
        text-align: center;
        box-shadow: 0 15px 40px rgba(255, 193, 7, 0.4);
        max-width: 500px;
        animation: popIn 0.6s ease;
    }

    @keyframes popIn {
        0% { transform: scale(0.7); opacity: 0; }
        100% { transform: scale(1); opacity: 1; }
    }

    .diya-glow {
        font-size: 4rem;
        color: var(--diwali-orange);
        text-shadow: 0 0 20px #ffb347, 0 0 40px #ffcc00;
        animation: flicker 1.5s infinite ease-in-out;
    }

    @keyframes flicker {
        0%, 100% { opacity: 1; text-shadow: 0 0 20px #ffb347; }
        50% { opacity: 0.8; text-shadow: 0 0 35px #ffd700; }
    }

    .diwali-message-box h2 {
        color: var(--diwali-red);
        font-weight: 800;
        margin-top: 15px;
    }

    .diwali-message-box p {
        color: #333;
        margin-top: 10px;
    }

    /* ================== ðŸŽ† DIWALI LOADING ANIMATION ================== */
    .diwali-loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(26, 26, 46, 0.98);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        backdrop-filter: blur(4px);
    }

    .diwali-loading-container {
        text-align: center;
    }

    /* ---- Rotating Chakra/Sparkler ---- */
    .diwali-chakra {
        width: 120px;
        height: 120px;
        margin: 0 auto 30px;
        position: relative;
        animation: chakraRotate 3s linear infinite;
    }

    @keyframes chakraRotate {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .chakra-center {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 2.5rem;
        animation: pulse 1.5s ease-in-out infinite;
    }

    @keyframes pulse {
        0%, 100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        50% { opacity: 0.6; transform: translate(-50%, -50%) scale(1.2); }
    }

    /* Sparks around the chakra */
    .chakra-spark {
        position: absolute;
        width: 40px;
        height: 40px;
        top: 50%;
        left: 50%;
        font-size: 1.8rem;
        display: flex;
        align-items: center;
        justify-content: center;
        animation: sparkleFloat 2s ease-in-out infinite;
    }

    .spark1 { animation-delay: 0s; transform: translate(-50%, -50%) rotate(0deg) translateY(-70px); }
    .spark2 { animation-delay: 0.25s; transform: translate(-50%, -50%) rotate(60deg) translateY(-70px); }
    .spark3 { animation-delay: 0.5s; transform: translate(-50%, -50%) rotate(120deg) translateY(-70px); }
    .spark4 { animation-delay: 0.75s; transform: translate(-50%, -50%) rotate(180deg) translateY(-70px); }
    .spark5 { animation-delay: 1s; transform: translate(-50%, -50%) rotate(240deg) translateY(-70px); }
    .spark6 { animation-delay: 1.25s; transform: translate(-50%, -50%) rotate(300deg) translateY(-70px); }

    @keyframes sparkleFloat {
        0%, 100% { 
            opacity: 1;
            filter: brightness(1);
            transform: translate(-50%, -50%) rotate(0deg) translateY(-70px) scale(1);
        }
        50% { 
            opacity: 0.4;
            filter: brightness(1.8) drop-shadow(0 0 8px #ffd700);
            transform: translate(-50%, -50%) rotate(0deg) translateY(-80px) scale(1.1);
        }
    }

    .loading-text {
        color: var(--diwali-gold);
        font-size: 1.5rem;
        font-weight: 700;
        margin-top: 30px;
        animation: fadeInOut 2s ease-in-out infinite;
        text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
    }

    .loading-subtext {
        color: var(--diwali-orange);
        font-size: 1rem;
        margin-top: 10px;
        animation: fadeInOut 2s ease-in-out infinite 0.3s;
    }

    @keyframes fadeInOut {
        0%, 100% { opacity: 0.6; }
        50% { opacity: 1; }
    }

    /* ==================== END LOADING ANIMATION ==================== */

    /* ================== ðŸŒŸ QUICK ORDER BUTTON ================== */
    .floating-quick-order {
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, #ffd700, #ff8c00);
        border-radius: 50%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 6px 20px rgba(255, 140, 0, 0.4);
        z-index: 999;
        transition: all 0.3s ease;
        border: 3px solid white;
        animation: floatUp 2s ease-in-out infinite;
    }

    @keyframes floatUp {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-10px); }
    }

    .floating-quick-order:hover {
        transform: scale(1.1);
        box-shadow: 0 8px 25px rgba(255, 140, 0, 0.6);
    }

    .floating-quick-order i {
        color: #1a1a2e;
        font-size: 1.5rem;
    }

    .quick-order-text {
        font-size: 0.6rem;
        font-weight: 700;
        color: #1a1a2e;
        text-align: center;
        margin-top: 2px;
    }

    @media (max-width: 768px) {
        .floating-quick-order {
            bottom: 100px;
            width: 50px;
            height: 50px;
        }
        
        .floating-quick-order i {
            font-size: 1.2rem;
        }
        
        .quick-order-text {
            font-size: 0.5rem;
        }
    }

    /* ================== ðŸ“¦ QUICK ORDER LISTS ================== */
    .quick-order-lists-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        padding: 20px 0;
    }

    .quick-order-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        border: 2px solid #e0e0e0;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
    }

    .quick-order-card:hover {
        transform: translateY(-8px);
        border-color: var(--diwali-orange);
        box-shadow: 0 8px 25px rgba(255, 140, 0, 0.2);
    }

    .quick-order-card-emoji {
        font-size: 3rem;
        margin-bottom: 10px;
        animation: pulse 2s ease-in-out infinite;
    }

    .quick-order-card-title {
        font-size: 1.2rem;
        font-weight: 700;
        color: #1a1a2e;
        margin-bottom: 8px;
    }

    .quick-order-card-desc {
        font-size: 0.85rem;
        color: #666;
        margin-bottom: 15px;
    }

    .quick-order-card-price {
        font-size: 1.4rem;
        font-weight: 700;
        color: var(--diwali-orange);
        margin-bottom: 10px;
    }

    .quick-order-card-btn {
        width: 100%;
        padding: 10px;
        border: none;
        border-radius: 8px;
        background: linear-gradient(135deg, var(--diwali-orange), var(--diwali-red));
        color: white;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .quick-order-card-btn:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 12px rgba(255, 140, 0, 0.3);
    }

    /* ================== ðŸ“‹ QUICK ORDER DETAILS ================== */
    .quick-order-products-list {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .quick-order-product-item {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 15px;
        display: flex;
        align-items: center;
        gap: 15px;
        border-left: 4px solid var(--diwali-gold);
    }

    .quick-order-product-image {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 8px;
    }

    .quick-order-product-info {
        flex: 1;
    }

    .quick-order-product-name {
        font-weight: 700;
        color: #1a1a2e;
        margin-bottom: 5px;
    }

    .quick-order-product-category {
        font-size: 0.8rem;
        color: #999;
        margin-bottom: 8px;
    }

    .quick-order-product-price {
        font-size: 1.1rem;
        color: var(--diwali-orange);
        font-weight: 700;
    }

    .quick-order-summary {
        background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 140, 0, 0.1));
        border: 2px solid var(--diwali-gold);
        border-radius: 10px;
        padding: 20px;
        margin-top: 20px;
    }

    .quick-order-summary-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        font-weight: 600;
    }

    .quick-order-summary-total {
        display: flex;
        justify-content: space-between;
        font-size: 1.3rem;
        color: var(--diwali-red);
        border-top: 2px solid var(--diwali-gold);
        padding-top: 15px;
        margin-top: 15px;
    }

    /* ==================== END QUICK ORDER ==================== */

<!-- Scrollable horizontal nav */
.category-nav {
    display: flex;
    align-items: center;
    overflow-x: auto;
    scroll-behavior: smooth;
    gap: 24px;
    padding: 0 16px;
    -webkit-overflow-scrolling: touch;
}

.category-nav::-webkit-scrollbar {
    display: none;
}

/* Remove old bubble styles completely */
.category-btn {
    all: unset; /* resets ALL inherited properties from old rules */
    display: inline-block;
    position: relative;
    cursor: pointer;
    color: rgba(255, 255, 255, 0.85);
    font-weight: 600;
    font-size: 0.95rem;
    padding: 10px 20px;
    text-decoration: none;
    text-transform: none;
    transition: all 0.3s ease;
    background: rgba(255, 255, 255, 0.08);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 25px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

/* Underline animation */
.category-btn::after {
    content: '';
    position: absolute;
    left: 0;
    bottom: -3px;
    width: 0%;
    height: 2px;
    background: linear-gradient(90deg, #ffd700, #ff8c00);
    transition: width 0.3s ease-in-out;
    border-radius: 2px;
}

/* Hover effect â€” glossy overlay + underline grow */
.category-btn:hover {
    color: #fff;
    background: rgba(255, 255, 255, 0.12);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    transform: translateY(-2px);
}
.category-btn:hover::after {
    width: 100%;
}

/* Active category â€” underline stays visible */
.category-btn.active {
    color: #fff;
    background: rgba(255, 107, 53, 0.2);
    border-color: rgba(255, 107, 53, 0.4);
    box-shadow: 0 0 15px rgba(255, 107, 53, 0.3);
}
.category-btn.active::after {
    width: 100%;
    background: linear-gradient(90deg, #ffcc00, #ff6b35);
}

/* Subtle glass gloss reflection */
.category-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -10%;
    width: 120%;
    height: 100%;
    background: linear-gradient(
        90deg,
        rgba(255, 255, 255, 0) 0%,
        rgba(255, 255, 255, 0.25) 50%,
        rgba(255, 255, 255, 0) 100%
    );
    opacity: 0;
    transform: translateX(-30%);
    transition: opacity 0.4s ease, transform 0.5s ease;
    pointer-events: none;
}

.category-btn:hover::before,
.category-btn.active::before {
    opacity: 0.25;
    transform: translateX(0);
}

/* Responsive tweak */
@media (max-width: 768px) {
    .category-subheader {
        background: transparent;
        padding: 15px 0;
        margin-bottom: 25px;
    }

    .category-nav {
        gap: 18px;
        padding: 0 10px;
    }

    .category-btn {
        font-size: 0.9rem;
        padding: 8px 16px;
    }
}
/* Scrollable horizontal nav */
.category-nav {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    overflow-x: auto;
    scroll-behavior: smooth;
    gap: 20px;
    padding: 0 16px;
}

.category-nav::-webkit-scrollbar {
    display: none;
}

/* Category buttons â€” minimalist plain text */
.category-btn {
    position: relative;
    background: transparent;
    color: rgba(255, 255, 255, 0.85);
    font-weight: 600;
    font-size: 0.95rem;
    text-decoration: none;
    border: none;
    padding: 6px 2px;
    cursor: pointer;
    transition: color 0.3s ease;
}

/* Gold underline â€” hidden by default */
.category-btn::after {
    content: '';
    position: absolute;
    left: 0;
    bottom: -3px;
    width: 0%;
    height: 2px;
    background: linear-gradient(90deg, #ffd700, #ff8c00);
    border-radius: 4px;
    transition: width 0.3s ease-in-out;
}

/* Hover effect â€” text glow + underline slide-in + glass shine */
.category-btn:hover {
    color: #fff;
    background: linear-gradient(
        rgba(255, 255, 255, 0.05),
        rgba(255, 255, 255, 0.15)
    );
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: #fff;
}
.category-btn:hover::after {
    width: 100%;
}

/* Active state â€” fixed gold underline */
.category-btn.active {
    color: #fff;
}
.category-btn.active::after {
    width: 100%;
    background: linear-gradient(90deg, #ffcc00, #ff6b35);
}

/* Subtle glossy overlay on hover/active */
.category-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -5%;
    width: 110%;
    height: 100%;
    background: linear-gradient(
        90deg,
        rgba(255, 255, 255, 0) 0%,
        rgba(255, 255, 255, 0.2) 50%,
        rgba(255, 255, 255, 0) 100%
    );
    opacity: 0;
    transform: translateX(-50%);
    transition: opacity 0.3s ease, transform 0.5s ease;
    pointer-events: none;
}
.category-btn:hover::before,
.category-btn.active::before {
    opacity: 0.3;
    transform: translateX(0);
}

/* ðŸ§± Responsive tweak for mobile */
@media (max-width: 768px) {
    .category-subheader {
        background: transparent;
        padding: 15px 0;
        margin-bottom: 25px;
    }

    .category-nav {
        gap: 16px;
        padding: 0 10px;
    }

    .category-btn {
        font-size: 0.9rem;
        padding: 8px 16px;
    }
}
/* Compact scrollable nav bar */
.category-nav {
    display: flex;
    align-items: center;
    overflow-x: auto;
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
    padding: 0 12px;
    gap: 10px;
}

.category-nav::-webkit-scrollbar {
    display: none;
}

/* Category buttons â€” flat, modern chips */
.category-btn {
    flex: 0 0 auto;
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 0.9rem;
    font-weight: 600;
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: rgba(255, 255, 255, 0.85);
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(12px);
    text-decoration: none;
    transition: all 0.25s ease-in-out;
}

/* Hover â€” gentle glow */
.category-btn:hover {
    color: #fff;
    border-color: rgba(255, 193, 7, 0.5);
    background: rgba(255, 255, 255, 0.12);
    box-shadow: 0 0 10px rgba(255, 193, 7, 0.2);
}

/* Active state â€” glowing gold gradient */
.category-btn.active {
    background: linear-gradient(135deg, #ffd700, #ff6b35);
    color: #1a1a2e;
    border: none;
    box-shadow: 0 0 15px rgba(255, 193, 7, 0.4);
    transform: scale(1.05);
}

/* Responsive tuning */
@media (max-width: 768px) {
    .category-subheader {
        background: transparent;
        padding: 15px 0;
        margin-bottom: 25px;
    }

    .category-btn {
        font-size: 0.85rem;
        padding: 8px 16px;
        border-radius: 20px;
    }

    .category-btn.active {
        transform: scale(1);
    }
}


.category-nav {
    display: flex;
    flex-wrap: nowrap;
    align-items: center;
    gap: 15px;
    padding: 0 20px;
    overflow-x: auto;
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    -ms-overflow-style: none;
}

.category-nav::-webkit-scrollbar {
    display: none;
}

.category-btn {
    background: radial-gradient(circle at top left, var(--diwali-gold), var(--diwali-orange));
    color: #1a1a2e;
    border: none;
    border-radius: 50px;
    padding: 12px 26px;
    font-weight: 700;
    letter-spacing: 0.5px;
    text-decoration: none;
    font-size: 0.95rem;
    box-shadow: 0 3px 12px rgba(255, 140, 0, 0.4);
    transition: all 0.35s ease;
    position: relative;
}

.category-btn:hover {
    transform: translateY(-2px);
    background: linear-gradient(135deg, var(--diwali-deep-gold), var(--diwali-orange));
    color: #fff;
    box-shadow: 0 4px 15px rgba(255, 193, 7, 0.5);
}

.category-btn:active {
    transform: translateY(0);
    box-shadow: 0 2px 8px rgba(255, 193, 7, 0.4);
}

.category-btn.active {
    background: linear-gradient(135deg, var(--diwali-red), var(--diwali-orange));
    color: #fff;
    box-shadow: 0 0 20px rgba(255, 107, 53, 0.8);
}

@media (max-width: 768px) {
    .category-subheader {
        background: transparent;
        border-radius: 0;
        padding: 15px 0;
        margin-bottom: 25px;
        box-shadow: none;
        position: relative;
        overflow: hidden;
    }

    .category-subheader::before,
    .category-subheader::after {
        content: '';
        position: absolute;
        top: 0;
        bottom: 0;
        width: 50px;
        z-index: 2;
        pointer-events: none;
    }

    .category-subheader::before {
        left: 0;
        background: linear-gradient(to right, rgba(26, 26, 46, 0.9), transparent);
    }

    .category-subheader::after {
        right: 0;
        background: linear-gradient(to left, rgba(26, 26, 46, 0.9), transparent);
    }

    .nav-scroll-btn {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: 40px;
        height: 40px;
        border: none;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--diwali-gold), var(--diwali-orange));
        color: #1a1a2e;
        font-size: 24px;
        line-height: 1;
        cursor: pointer;
        z-index: 3;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
    }

    .nav-scroll-btn:hover {
        background: linear-gradient(135deg, var(--diwali-deep-gold), var(--diwali-orange));
        transform: translateY(-50%) scale(1.1);
    }

    .nav-scroll-left {
        left: 5px;
    }

    .nav-scroll-right {
        right: 5px;
    }

    .category-nav {
        display: flex;
        flex-wrap: nowrap;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        scroll-behavior: smooth;
        gap: 12px;
        padding: 5px 40px;
        position: relative;
        margin: 0;
        width: 100%;
        -ms-overflow-style: none;
        scrollbar-width: none;
    }

    .category-nav::-webkit-scrollbar {
        display: none;
    }

    .category-nav::-webkit-scrollbar {
        display: none;
    }

    .category-btn {
        flex: 0 0 auto;
        background: linear-gradient(135deg, var(--accent-color), var(--secondary-color));
        color: #fff;
        padding: 10px 20px;
        border-radius: 30px;
        font-size: 0.9rem;
        white-space: nowrap;
        font-weight: 700;
        box-shadow: 0 2px 10px rgba(255, 107, 53, 0.5);
        transition: all 0.3s ease;
        min-width: max-content;
    }

    .category-btn.active {
        opacity: 1;
        transform: scale(1);
        background: linear-gradient(135deg, var(--diwali-deep-gold), var(--diwali-orange));
        box-shadow: 0 4px 15px rgba(255, 140, 0, 0.6);
    }

    .category-btn:first-child {
        margin-left: 0;
    }

    .category-btn:last-child {
        margin-right: 0;
    }

    .category-btn:active {
        transform: scale(0.96);
        background: linear-gradient(135deg, var(--secondary-color), var(--diwali-orange));
    }

    .category-btn.active {
        background: linear-gradient(135deg, #ff4500, #ffb347);
        box-shadow: 0 0 20px rgba(255, 140, 0, 0.8);
    }

    /* Left & Right Fade Shadows */
    .category-subheader::before,
    .category-subheader::after {
        content: '';
        position: absolute;
        top: 0;
        width: 30px;
        height: 100%;
        z-index: 2;
        pointer-events: none;
        transition: opacity 0.3s ease;
    }

    .category-subheader::before {
        left: 0;
        background: linear-gradient(to right, rgba(26, 26, 46, 1) 40%, rgba(26, 26, 46, 0));
    }

    .category-subheader::after {
        right: 0;
        background: linear-gradient(to left, rgba(26, 26, 46, 1) 40%, rgba(26, 26, 46, 0));
    }
}
/* -------------------- ðŸ’» TABLET VIEW -------------------- */
@media (max-width: 1024px) and (min-width: 769px) {
    .category-subheader {
        padding: 15px 0;
        margin-bottom: 30px;
    }

    .category-btn {
        font-size: 0.9rem;
        padding: 10px 22px;
    }
}


    /* -------------------- ðŸ“± RESPONSIVE LAYOUTS -------------------- */
    @media (min-width: 1025px) {
        /* System / Desktop View */
        .product-card {
            min-height: 420px;
        }
    }

    @media (max-width: 1024px) and (min-width: 769px) {
        /* Tablet View */
        .product-card {
            min-height: 380px;
        }
        .page-title { font-size: 2.5rem; }
    }

    @media (max-width: 768px) {
        /* Mobile View */
        .page-title { font-size: 2rem; }
        .floating-cart {
            bottom: 20px;
            right: 20px;
            padding: 12px 18px;
        }
        .card-body { padding: 15px; }
        .card-title { font-size: 1.1rem; }
        .price { font-size: 1.1rem; }
    }
/* -------------------- ðŸ§± Desktop Grid -------------------- */
.product-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 1.5rem;
    position: relative;
}
.ribbon-view {
    display: none !important; /* Hide ribbon view on desktop/tablet */
}
.product-card > .card-body:not(.ribbon-view) {
    display: block !important; /* Show normal card by default */
}
@media (max-width: 768px) {

    /* Hide desktop card body */
    .product-card > .card-body:not(.ribbon-view) {
        display: none !important;
    }

    /* Ribbon view only */
    .ribbon-view {
        display: flex !important;
        flex-direction: column;
        background: linear-gradient(90deg, #ffffff, #fff8e1);
        border-radius: 12px;
        padding: 8px 12px;
        gap: 4px;
        box-shadow: 0 4px 12px rgba(255, 193, 7, 0.25);
        position: relative;
    }

    /* Hide the wide desktop banners */
    .product-card > .card-image-container .product-badge {
        display: none !important;
    }

    /* ---------- TOP ROW ---------- */
    .product-top-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 8px;
        width: 100%;
    }

    .card-image-container {
        flex: 0 0 35px;
        height: 35px;
        border-radius: 8px;
        overflow: hidden;
        position: relative;
    }

    .card-img-top {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 6px;
    }

    /* Tiny corner badge (folded-style) */
    .ribbon-view .product-badge {
        display: inline-block !important;
        position: absolute;
        top: 0;
        left: 0;
        font-size: 0.55rem;
        padding: 3px 6px;
        border-top-left-radius: 6px;
        border-bottom-right-radius: 6px;
        background: linear-gradient(135deg, var(--accent-color), var(--secondary-color));
        color: #fff;
        font-weight: 600;
        box-shadow: 0 1px 4px rgba(255, 107, 53, 0.4);
    }

    .ribbon-view .low-stock-badge {
        background: linear-gradient(135deg, #dc3545, #b30000);
    }

    /* ---------- TITLE ---------- */
    .card-title {
        flex: 1;
        font-size: 0.95rem;
        font-weight: 700;
        color: #1a1a2e;
        margin: 0;
        padding-left: 6px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    /* Quantity selector */
    .quantity-selector {
        display: flex;
        align-items: center;
        height: 35px;
    }

    .quantity-selector .input-group {
        display: flex;
        align-items: center;
        width: 70px;
        height: 25px;
    }

    .quantity-selector .btn {
        padding: 1px 5px;
        font-size: 0.75rem;
        height: 25px;
    }

    .quantity-input {
        width: 30px;
        text-align: center;
        font-size: 0.75rem;
        height: 25px;
        padding: 1px;
    }

    /* Cart button */
    .add-to-cart {
        flex: 0 0 35px;
        height: 35px;
        width: 35px;
        border-radius: 8px;
        background: linear-gradient(135deg, var(--accent-color), var(--secondary-color));
        color: white;
        border: none;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
        box-shadow: 0 2px 8px rgba(255, 107, 53, 0.5);
    }

    .add-to-cart:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }

    /* ---------- BOTTOM ROW ---------- */
    .product-bottom-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-left: 45px;
        padding-right: 10px;
    }

    .price {
        font-weight: 700;
        color: var(--primary-color);
        font-size: 0.9rem;
    }

    .stock-info {
        font-weight: 600;
        font-size: 0.8rem;
        color: #444;
        white-space: nowrap;
    }

    .stock-info.text-danger {
        color: #dc3545 !important;
    }

    /* Hide unnecessary fields */
    .category-tag,
    .item-total,
    .category-description {
        display: none !important;
    }
}
/* -------------------- ðŸŽ¨ CATEGORY HEADER FIX (no white box) -------------------- */
.category-section {
    background: transparent !important; /* Keep background as is */
    padding: 0 10px 25px 10px;
    margin-bottom: 35px;
}

/* Category title â€” bright white with golden glow */
.category-title {
    color: #ffffff !important;
    font-weight: 800;
    font-size: 1.6rem;
    text-align: left;
    margin-bottom: 8px;
    letter-spacing: 0.5px;
    text-shadow: 
        0 0 8px rgba(255, 255, 255, 0.9),
        0 0 16px rgba(255, 193, 7, 0.5);
}

/* Thin glowing gold divider */
.category-divider {
    height: 3px;
    width: 100%;
    border-radius: 3px;
    background: linear-gradient(90deg, #ffd700, #ff8c00);
    box-shadow: 0 0 10px rgba(255, 215, 0, 0.6);
    margin-bottom: 18px;
}

/* Category description â€” soft white and subtle */
.category-description {
    color: rgba(255, 255, 255, 0.9);
    font-size: 0.95rem;
    margin-bottom: 12px;
    line-height: 1.4;
    text-shadow: 0 0 8px rgba(0, 0, 0, 0.6);
}
/* ======================================================
   ðŸŽ¯ TRANSPARENT CATEGORY SUBHEADER (SINGLE-LINE CATEGORIES)
   ====================================================== */

/* --- Subheader container (transparent & overlayed) --- */
.category-subheader {
    position: sticky !important;
    top: 70px !important;
    z-index: 999 !important;
    background: transparent !important; /* completely transparent */
    backdrop-filter: blur(0px) !important; /* no blur, pure overlay */
    border: none !important;
    box-shadow: none !important;
    padding: 8px 0 !important;
    margin-bottom: 10px !important;
}

/* --- Category navigation bar (scrollable but single-line) --- */
.category-nav {
    display: flex !important;
    align-items: center !important;
    justify-content: flex-start !important;
    flex-wrap: nowrap !important; /* ensure all categories stay in a single line */
    gap: 22px !important;
    padding: 0 16px !important;
    overflow-x: auto !important;
    overflow-y: hidden !important; /* prevent text from wrapping to next line */
    white-space: nowrap !important; /* keep all items in a single line */
    scroll-behavior: smooth !important;
    -webkit-overflow-scrolling: touch !important;
}

.category-nav::-webkit-scrollbar {
    display: none !important;
}

/* --- Category buttons: minimalist, flat text --- */
.category-btn {
    all: unset !important;
    display: inline-block !important;
    position: relative !important;
    cursor: pointer !important;
    color: rgba(255, 255, 255, 0.9) !important;
    font-weight: 600 !important;
    font-size: 1rem !important;
    text-decoration: none !important;
    padding: 6px 0 !important;
    transition: color 0.3s ease !important;
    white-space: nowrap !important; /* ensure no wrapping within each category name */
}

/* --- Hover + Active underline animation --- */
.category-btn::after {
    content: "" !important;
    position: absolute !important;
    left: 0 !important;
    bottom: -3px !important;
    width: 0 !important;
    height: 2px !important;
    background: linear-gradient(90deg, #ffd700, #ff8c00) !important;
    border-radius: 3px !important;
    transition: width 0.3s ease-in-out !important;
}

.category-btn:hover {
    color: #fff !important;
}

.category-btn:hover::after,
.category-btn.active::after {
    width: 100% !important;
}

.category-btn.active::after {
    background: linear-gradient(90deg, #ffcc00, #ff6b35) !important;
}

/* --- Subtle glossy hover reflection --- */
.category-btn::before {
    content: "" !important;
    position: absolute !important;
    top: 0 !important;
    left: -10% !important;
    width: 120% !important;
    height: 100% !important;
    background: linear-gradient(
        90deg,
        rgba(255, 255, 255, 0) 0%,
        rgba(255, 255, 255, 0.25) 50%,
        rgba(255, 255, 255, 0) 100%
    ) !important;
    opacity: 0 !important;
    transform: translateX(-30%) !important;
    transition: opacity 0.4s ease, transform 0.5s ease !important;
    pointer-events: none !important;
}

.category-btn:hover::before,
.category-btn.active::before {
    opacity: 0.25 !important;
    transform: translateX(0) !important;
}

/* --- Mobile and Tablet Responsiveness --- */
@media (max-width: 768px) {
    .category-subheader {
        top: 60px !important;
        background: transparent !important;
        backdrop-filter: none !important;
        border: none !important;
        box-shadow: none !important;
    }

    .category-nav {
        gap: 16px !important;
        padding: 0 10px !important;
        overflow-x: auto !important;
        white-space: nowrap !important;
    }

    .category-btn {
        font-size: 0.9rem !important;
        padding: 5px 0 !important;
        white-space: nowrap !important;
    }

    .category-btn::after {
        bottom: -2px !important;
        height: 2px !important;
    }
}

/* --- Tablet scaling --- */
@media (min-width: 769px) and (max-width: 1024px) {
    .category-btn {
        font-size: 0.95rem !important;
        padding: 6px 0 !important;
        white-space: nowrap !important;
    }

    .category-nav {
        gap: 20px !important;
        padding: 0 12px !important;
        white-space: nowrap !important;
    }
}
/* ======================================================
   âœ¨ FIX: Visible Gold Underline Animation
   ====================================================== */

/* Base underline setup */
.category-btn::after {
    content: "";
    position: absolute;
    left: 0;
    bottom: -3px;
    width: 0%;
    height: 2px;
    background: linear-gradient(90deg, #ffd700, #ff8c00);
    border-radius: 2px;
    transition: width 0.35s ease-in-out;
    opacity: 0.9;
    box-shadow: 0 0 8px rgba(255, 215, 0, 0.4);
}

/* Hover/Active states */
.category-btn:hover::after,
.category-btn.active::after {
    width: 100%;
    opacity: 1;
    box-shadow: 0 0 12px rgba(255, 215, 0, 0.6),
                0 0 20px rgba(255, 140, 0, 0.4);
}

/* On hover, add smooth gold glow effect */
.category-btn:hover {
    color: #fff !important;
    text-shadow: 0 0 8px rgba(255, 215, 0, 0.4);
}

/* Keep glow stronger for active category */
.category-btn.active {
    color: #fff !important;
    text-shadow: 0 0 10px rgba(255, 200, 0, 0.6);
}

/* Responsive fine-tuning */
@media (max-width: 768px) {
    .category-btn::after {
        bottom: -2px;
        height: 2px;
    }
}

/* ======================================================
   ðŸ“± RESPONSIVE FIX FOR DIWALI SUCCESS POPUP (MOBILE)
   ====================================================== */
@media (max-width: 768px) {

    /* Overlay adjusts properly */
    .diwali-success-overlay {
        padding: 20px;
    }

    /* Popup box scales well */
    .diwali-message-box {
        width: 90%;
        max-width: 350px;
        padding: 25px 20px;
        border-radius: 15px;
    }

    /* Reduce diya size */
    .diya-glow {
        font-size: 2.9rem;
    }

    /* Heading size fix */
    .diwali-message-box h2 {
        font-size: 1.6rem;
        margin-top: 10px;
        line-height: 1.3;
    }

    /* Paragraph size & spacing */
    .diwali-message-box p {
        font-size: 0.95rem;
        line-height: 1.4;
        margin-top: 10px;
    }

    /* Confetti effect lightweight for mobile */
    .confetti-small {
        width: 5px !important;
        height: 5px !important;
    }
}
.diwali-success-overlay.active {
    display: flex;
    align-items: center;
    justify-content: center;
}
/* Banner */
.home-banner {
    width: 100%;
    height: auto;
    border-radius: 0;
    margin-bottom: 20px;
}
/* ðŸŽ‡ DIWALI SALES BANNER WITH DYNAMIC YEAR */
.diwali-sales-banner {
    text-align: center;
    margin-top: 30px;
    margin-bottom: 30px;
    padding: 20px;
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
    border-radius: 12px;
    box-shadow: 0 8px 25px rgba(255, 107, 53, 0.3);
}

.diwali-banner-title {
    color: #ffd500d8;
    font-weight: 700;
    font-size: 1.8rem;
    margin: 0;
    letter-spacing: 0.5px;
    text-shadow: 0 0 10px rgba(255, 107, 53, 0.5);
    line-height: 1.4;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .diwali-sales-banner {
        margin-top: 20px;
        margin-bottom: 20px;
        padding: 15px;
    }

    .diwali-banner-title {
        font-size: 1.3rem;
    }
}

@media (max-width: 576px) {
    .diwali-sales-banner {
        padding: 10px;
    }

    .diwali-banner-title {
        font-size: 1.1rem;
    }
}
/* ======================================
   DESKTOP FIX (â‰¥ 992px)  
   Perfect center alignment
====================================== */
@media (min-width: 992px) {

    /* Remove container restriction */
    .category-subheader {
        width: 100%;
        padding: 20px 0;
        display: flex;
        justify-content: center;
        align-items: center;
        background: transparent;
        position: relative;
    }

    /* Center the nav */
    .category-nav {
        display: flex;
        justify-content: center;
        gap: 25px;
        width: auto;
        padding: 0;
        overflow: visible !important;
        white-space: nowrap;
    }

    /* Desktop category buttons */
    .category-btn {
        font-size: 17px;
        font-weight: 600;
        color: #ff6600;
        padding: 6px 12px;
        border-radius: 6px;
        transition: 0.2s ease;
    }

    .category-btn:hover {
        background: #fff2dd;
        color: #cc5500;
    }

    /* HIDE ARROWS COMPLETELY */
    .nav-scroll-btn {
        display: none !important;
    }
}


/* ======================================
   TABLET FIX (768px â€“ 991px)
====================================== */
@media (min-width: 768px) and (max-width: 991px) {
    .category-subheader {
        padding: 15px 0;
    }

    .category-nav {
        gap: 18px;
    }
}


/* ======================================
   MOBILE (â‰¤ 767px)
   â€“ Keep arrows
   â€“ Keep horizontal scroll
====================================== */
@media (max-width: 767px) {

.category-subheader {
    position:relative !important;   /* Removes sticky/fixed */
    top: unset !important;
    z-index: auto !important;
    background: transparent !important;
}

    .category-nav {
        overflow-x: auto;
        white-space: nowrap;
        padding: 5px 48px !important;
        gap: 12px;
    }
}

</style>
{% endblock %}

{% block content %}


<div class="crackers-container" id="crackersContainer"></div>
<!-- Banner -->

<!-- Floating Cart -->
<div class="floating-cart" role="button" data-bs-toggle="modal" data-bs-target="#cartModal">
    <i class="bi bi-cart3"></i>
    â‚¹<span id="cart-total">0.00</span>
    <span class="cart-items-count">(0 items)</span>
</div>

<!-- Quick Order Button -->
<div class="floating-quick-order" role="button" data-bs-toggle="modal" data-bs-target="#quickOrderModal" title="Quick Order">
    <i class="bi bi-lightning-fill"></i>
    <span class="quick-order-text">Quick Order</span>
</div>

<!-- Cart Modal -->
<div class="modal fade" id="cartModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Shopping Cart</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="cartItems" class="mb-4">
                    <!-- Cart items will be dynamically inserted here -->
                    <div class="text-center text-muted py-4">
                        <i class="fa-solid fa-cart-plus" style="font-size: 3rem;"></i>
                        <p class="mt-2">Your cart is empty</p>
                    </div>
                </div>
                <div class="cart-summary-details mb-4">
                    <h4>Order Summary</h4>
                    <div class="d-flex justify-content-between">
                        <span>Subtotal:</span>
                        <span>â‚¹<span id="modalSubtotal">0.00</span></span>
                    </div>
                    <!-- Minimum Order Alert -->
                    <div id="minOrderAlert" class="alert alert-warning alert-dismissible fade show mt-3" role="alert" style="display: none;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <i class="bi bi-exclamation-triangle-fill" style="font-size: 1.2rem; color: #856404;"></i>
                            <div>
                                <strong>Minimum Order Required!</strong>
                                <p class="mb-0 mt-1">You need to add â‚¹<span id="shortfallAmount">0.00</span> more items to reach the minimum order of â‚¹3000</p>
                            </div>
                        </div>
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                </div>
                <form id="checkoutForm" class="needs-validation" novalidate>
                    {% csrf_token %}
                    <h4>Customer Details</h4>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="fullName" name="full_name" 
                                value="{{ user.get_full_name }}" 
                                placeholder="Enter Full Name" required>
                            <div class="invalid-feedback">Please enter your name</div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Phone Number</label>
                            <input type="tel" class="form-control" id="phone" name="phone" 
                                value="{{ user.phone_number }}"
                                pattern="[0-9]{10}" placeholder="Enter 10-digit Phone Number" required>
                            <div class="invalid-feedback">Please enter a valid 10-digit phone number</div>
                        </div>
                        <div class="col-12">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" id="email" name="email" 
                                value="{{ user.email }}"
                                placeholder="Enter Email Address" required>
                            <div class="invalid-feedback">Please enter a valid email</div>
                        </div>
                        <div class="col-12">
                            <label class="form-label">Delivery Address</label>
                            <textarea class="form-control" id="deliveryAddress" name="delivery_address" 
                                rows="3" placeholder="Enter Complete Delivery Address" required>{{ user.address }}</textarea>
                            <div class="invalid-feedback">Please enter your delivery address</div>
                        </div>
                        {% if user.is_authenticated %}
                        <div class="col-12">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="updateProfile" name="update_profile">
                                <label class="form-check-label" for="updateProfile">
                                    Save these details to my profile
                                </label>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Continue Shopping</button>
                <button type="button" class="btn btn-primary" id="proceedToCheckout">Proceed to Checkout</button>
            </div>
        </div>
    </div>
</div>

<!-- Quick Order Modal -->
<div class="modal fade" id="quickOrderModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-gradient" style="background: linear-gradient(135deg, #ff8c00, #ff6b35);">
                <h5 class="modal-title text-white">
                    <i class="bi bi-lightning-fill"></i> Quick Order - Pre-Made Lists
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="quickOrderListsContainer" class="quick-order-lists-container">
                    <div class="text-center py-5">
                        <div class="spinner-border text-warning" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-3">Loading quick order lists...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Quick Order Details Modal -->
<div class="modal fade" id="quickOrderDetailsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-gradient" style="background: linear-gradient(135deg, #ff8c00, #ff6b35);">
                <h5 class="modal-title text-white" id="detailsModalTitle"></h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="quickOrderDetailsContent">
                    <!-- Products will be populated here -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Back</button>
                <button type="button" class="btn btn-primary" id="proceedQuickOrderCheckout">
                    <i class="bi bi-check-circle"></i> Proceed to Checkout
                </button>
            </div>
        </div>
    </div>
</div>

<div class="inventory-container">
<div id="diwaliLoadingOverlay" class="diwali-loading-overlay" style="display: none;">
    <div class="diwali-loading-container">
        <!-- Rotating Chakra/Sparkler -->
        <div class="diwali-chakra">
            <div class="chakra-center">âœ¨</div>
            <div class="chakra-spark spark1">ðŸŽ†</div>
            <div class="chakra-spark spark2">âœ¨</div>
            <div class="chakra-spark spark3">ðŸŽ‡</div>
            <div class="chakra-spark spark4">ðŸ’«</div>
            <div class="chakra-spark spark5">ðŸŒŸ</div>
            <div class="chakra-spark spark6">âœ¨</div>
        </div>
        <h3 class="loading-text">Processing Your Order...</h3>
        <p class="loading-subtext">ðŸª” Celebrating with you! Please wait... ðŸª”</p>
    </div>
</div>

<div class="inventory-container">
    <div class="container">
<img src="{% static 'images/homes.jpg' %}" class="home-banner">
        <!-- Category Subheader -->
        <div class="category-subheader">
            <button class="nav-scroll-btn nav-left">&lt;</button>

            <div class="category-nav">
                {% for category in categories %}
                <a href="#category-{{ category.id }}" class="category-btn" data-category-id="{{ category.id }}">
                    {{ category.name }}
                </a>
                {% endfor %}
            </div>
                <!-- Right Arrow -->
    <button class="nav-scroll-btn nav-right">&gt;</button>
                </div>
</div>

        </div>

<style>

/* =====================================================
   ðŸš€ CATEGORY NAVIGATION ARROWS â€” SHOW ON ALL SCREENS
   ===================================================== */

.nav-scroll-btn {
    display: flex !important;
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: none;
    background: linear-gradient(135deg, #ffd700, #ff8c00);
    color: #1a1a2e;
    font-size: 22px;
    align-items: center;
    justify-content: center;
    z-index: 999;
    cursor: pointer;
    box-shadow: 0 3px 10px rgba(0,0,0,0.35);
    transition: 0.25s ease;
}

.nav-left  { left: 5px; }
.nav-right { right: 5px; }

.category-nav {
    padding: 0 55px !important;
    scroll-behavior: smooth;
    white-space: nowrap;
    display: flex;
    flex-wrap: nowrap;
    overflow-x: auto !important;    /* â† FORCE SCROLL ON LAPTOP */
}

.category-nav::-webkit-scrollbar {
    display: none;
}

/* ðŸ”¸ Show and style only on mobile */
@media (max-width: 768px) {

    .category-subheader {
        position: relative;
        padding: 15px 0;
    }

    .nav-scroll-btn {
        display: flex; /* now they appear only in mobile */
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: 38px;
        height: 38px;
        border-radius: 50%;
        border: none;
        background: linear-gradient(135deg, #7a7a7a, #665892);
        color: #1a1a2e;
        font-size: 20px;
        align-items: center;
        justify-content: center;
        z-index: 991;
        cursor: pointer;
        transition: 0.25s ease;
    }

    .nav-left  { left: 5px; }
    .nav-right { right: 5px; }

    .category-nav {
        padding: 5px 48px !important; /* space so arrows don't overlap text */
    }
}


</style>
<script>
document.addEventListener("DOMContentLoaded", () => {

    const nav = document.querySelector(".category-nav");
    const left = document.querySelector(".nav-left");
    const right = document.querySelector(".nav-right");

    if (!nav || !left || !right) return;

    left.addEventListener("click", () => {
        nav.scrollBy({
            left: -250,      // Laptop-friendly scroll amount
            behavior: "smooth"
        });
    });

    right.addEventListener("click", () => {
        nav.scrollBy({
            left: 250,
            behavior: "smooth"
        });
    });
});

</script>

<div class="container mt-4">
    <!-- ðŸŽ‡ DIWALI SALES BANNER WITH DYNAMIC YEAR -->
    <div class="diwali-sales-banner">
        <h1 class="diwali-banner-title">
            Diwali sales on {{ now.year }} Upto 80% off Minimum order 3000 rupees only
        </h1>
    </div>

    <!-- ðŸ”¶ CATEGORY TABLES (SPARKLER ITEMS, FLOWER POTS, etc.) -->
    {% for category, products_in_category in products_by_category.items %}
    <div class="category-section" id="category-{{ category.id }}">

    <!-- invisible anchor for scroll accuracy -->
    <a id="scroll-target-{{ category.id }}" class="category-scroll-anchor"></a>

    <!-- Title bar (hidden on mobile) -->
    <div class="category-title-bar">
        {{ category.name|upper }}
    </div>

        <div class="order-table-wrapper table-responsive">
            <table class="kannan-order-table">
                <thead>
                    <tr>
                        <th class="sno-col">S.No</th>
                        <th class="img-col">Image</th>
                        <th class="name-col">Product Name</th>
                        <th class="content-col">Content</th>
                        <th class="money-col mrp">Actual Price</th>
                        <th class="money-col discount">80% off</th>
                        <th class="money-col amount">Amount</th>
                        <th class="qty-col">Quantity</th>
                        <th class="total-col">Total</th>
                    </tr>
                </thead>
                <tbody>
                    {% for product in products_in_category %}
                    <tr class="order-row"
                        data-mrp="{{ product.price }}"
                        data-product-id="{{ product.id }}">
                        <td class="sno-col">{{ forloop.counter }}</td>

                        <td class="img-col">
                            {% if product.image %}
                                <img src="{{ product.image.url }}" alt="{{ product.name }}">
                            {% else %}
                                <span>No Image</span>
                            {% endif %}
                        </td>

                        <td class="name-col">
                            {{ product.name }}
                        </td>

                        <td class="content-col">
                            {% if product.content %}
                                {{ product.content }}
                            {% else %}
                                1 BOX
                            {% endif %}
                        </td>

                        <!-- MRP per unit (will be multiplied by qty in JS) -->
                        <td class="money-col mrp">
                            â‚¹<span class="mrp-val">{{ product.price }}</span>
                        </td>

                        <!-- Discount and Amount columns are calculated in JS -->
                        <td class="money-col discount">
                            â‚¹<span class="discount-val">0.00</span>
                        </td>
                        <td class="money-col amount">
                            â‚¹<span class="amount-val">0.00</span>
                        </td>

                        <td class="qty-col">
                            <input type="number"
                                   class="qty-input"
                                   min="0"
                                   value="0">
                        </td>

                        <td class="total-col">
                            â‚¹<span class="row-total-val">0.00</span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
         <!-- MOBILE ITEMS GO HERE (inside category section) -->
    {% for product in products_in_category %}
    <div class="mobile-product-item"
         data-product-id="{{ product.id }}"
         data-mrp="{{ product.price }}">

        <div class="mobile-top">
            <div class="mobile-img">
                {% if product.image %}
                <img src="{{ product.image.url }}" alt="{{ product.name }}">
                {% endif %}
            </div>

            <div class="mobile-info">
                <div class="mobile-name">{{ product.name }}</div>
                <div class="mobile-content">
                    {% if product.content %}{{ product.content }}{% else %}1 BOX{% endif %}
                </div>

                <div class="mobile-price-row">
                    <span class="mobile-mrp">â‚¹{{ product.price }}</span>
                    <span class="mobile-our amount-val">â‚¹0</span>
                </div>
            </div>
        </div>

<div class="mobile-bottom">
    <div class="qty-box">
        <button class="qty-btn minus">âˆ’</button>
        <input type="number" class="qty-input" min="0" value="0">
        <button class="qty-btn plus">+</button>
    </div>

    <div class="mobile-total">â‚¹<span class="row-total-val">0.00</span></div>
</div>


    </div>
    {% endfor %}
    </div>
    {% endfor %}

</div>
<!-- ðŸŒŸ FULL IMAGE VIEW MODAL -->
<div class="modal fade" id="imageModal" tabindex="-1">
  <div class="modal-dialog modal-fullscreen-sm-down modal-lg">
    <div class="modal-content" style="background: rgba(0,0,0,0.85);">
      <div class="modal-body d-flex justify-content-center align-items-center p-0">

        <img id="modalImage" src="" alt="Product Image"
             style="max-height: 90vh; max-width: 95vw; object-fit: contain; border-radius: 10px;">

      </div>
      <button type="button" class="btn-close btn-close-white position-absolute top-0 end-0 m-3"
              data-bs-dismiss="modal"></button>
    </div>
  </div>
</div>
<script>
    // PRODUCT IMAGE CLICK â†’ OPEN FULL VIEW MODAL
document.addEventListener("DOMContentLoaded", function () {
    const modal = new bootstrap.Modal(document.getElementById('imageModal'));
    const modalImg = document.getElementById('modalImage');

    document.querySelectorAll(".img-col img, .mobile-img img").forEach(img => {
        img.style.cursor = "pointer";

        img.addEventListener("click", () => {
            modalImg.src = img.src;
            modal.show();
        });
    });
});

</script>
<style>
    /* MOBILE PLUS & MINUS BUTTONS */
@media (max-width: 768px) {

    .qty-box {
        display: flex;
        align-items: center;
        gap: 6px;
        background: rgba(255,255,255,0.1);
        padding: 4px 8px;
        border-radius: 8px;
    }

    .qty-btn {
        width: 28px;
        height: 28px;
        border-radius: 6px;
        border: none;
        font-size: 20px;
        font-weight: 700;
        color: #fff;
        background: linear-gradient(135deg, #ff9800, #ff5722);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }

    .qty-btn:active {
        transform: scale(0.95);
    }

    .qty-input {
        width: 40px !important;
        height: 28px !important;
        text-align: center;
        border-radius: 4px;
        border: none;
        font-weight: 700;
        font-size: 0.85rem;
    }
}

</style>
<script>
    document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll(".mobile-product-item").forEach(box => {

        const minusBtn = box.querySelector(".qty-btn.minus");
        const plusBtn = box.querySelector(".qty-btn.plus");
        const qtyInput = box.querySelector(".qty-input");

        minusBtn.addEventListener("click", () => {
            let qty = parseInt(qtyInput.value) || 0;
            if (qty > 0) qtyInput.value = qty - 1;
            qtyInput.dispatchEvent(new Event("input"));
        });

        plusBtn.addEventListener("click", () => {
            let qty = parseInt(qtyInput.value) || 0;
            qtyInput.value = qty + 1;
            qtyInput.dispatchEvent(new Event("input"));
        });

    });
});

</script>
<!-- Part 1: Clean Mobile CSS Integration -->
<style>

/* =====================================================
   âœ” Desktop = Show Table
   âœ” Mobile = Hide Table + Show Mobile Cards
   ===================================================== */

/* ---------- DESKTOP MODE (>=769px) ---------- */
@media (min-width: 769px) {

    /* Show desktop table */
    .order-table-wrapper table {
        display: table !important;
    }

    /* Hide mobile cards */
    .mobile-product-item {
        display: none !important;
    }

    /* Show category title bar */
    .category-title-bar {
        display: block !important;
    }

    /* Restore spacing for desktop */
    .container.mt-4,
    .inventory-container,
    .page-header,
    .product-grid,
    .category-section {
        margin-top: 20px !important;
        padding-top: 0 !important;
    }
}
.category-scroll-anchor {
    display: block;
    position: relative;
    top: -80px;  /* adjust for sticky header height */
    height: 0;
    visibility: hidden;
}

/* ---------- MOBILE MODE (<=768px) ---------- */
@media (max-width: 768px) {

    /* Hide desktop table */
    .order-table-wrapper table {
        display: none !important;
    }

    /* Show mobile cards */
    .mobile-product-item {
        display: block !important;
    }

    /* Hide desktop category title bar */
@media (max-width: 768px) {
    .category-title-bar {
        border-bottom: 1px solid rgba(255, 255, 255, 0.25);  /* white transparent line */
                padding-bottom: 12px;
        margin-bottom: 12px;
        display: block !important;
        margin-top: 10px;
    }
}
@media (max-width: 768px) {
    .mobile-product-item {
        border-bottom: 1px solid rgba(255, 255, 255, 0.25);  /* white transparent line */
        padding-bottom: 12px;
        margin-bottom: 12px;
    }
}

    /* Remove blank space */
    .container.mt-4,
    .inventory-container,
    .page-header,
    .product-grid,
    .category-section {
        margin-top: 0 !important;
        padding-top: 0 !important;
    }
@media (max-width: 768px) {

    .mobile-name {
        font-size: 1rem;
        font-weight: 700;
        color: #ffffff !important;   /* ðŸ”¥ White text */
    }

}


    .mobile-top { display: flex; gap: 12px; }
    .mobile-img { width: 55px; height: 55px; border-radius: 6px; overflow: hidden; flex-shrink: 0; }
    .mobile-img img { width: 100%; height: 100%; object-fit: cover; }
    .mobile-info { flex-grow: 1; }
    .mobile-name { font-size: 1rem; font-weight: 700; }
    .mobile-content { font-size: 0.85rem; color: orange; font-weight: 600; }
    .mobile-price-row { display: flex; gap: 12px; margin-top: 4px; }
    .mobile-mrp { color: #ff4d4d; text-decoration: line-through; font-weight: 700; }
    .mobile-our { color: #00ff66; font-weight: 700; }
    .mobile-bottom { display: flex; justify-content: flex-end; gap: 14px; margin-top: 12px; }
    .mobile-bottom input.qty-input { width: 55px; height: 32px; text-align: center; border-radius: 6px; border: none; font-weight: 700; }
    .mobile-total { background: rgb(100, 100, 125); padding: 6px 10px; border-radius: 6px; font-weight: 700; }
    .product-content{color: white;}
}
</style>



{% endblock content %}


{% block extra_js %}
<script src="{% static 'inventory/checkout.js' %}"></script>
<script>

// =====================================================
// ðŸ›’ GLOBAL CART
// =====================================================
let cart = [];

// =====================================================
// ðŸŸ  UNIFIED updateCart() FOR BOTH DESKTOP + MOBILE
// =====================================================
function updateCart(productId, row, qty, amount, mrp) {

    const name =
        row.querySelector(".name-col")?.textContent.trim() ||
        row.querySelector(".mobile-name")?.textContent.trim() ||
        "Unknown Item";

    let existing = cart.find(i => i.id == productId);

    if (qty == 0) {
        cart = cart.filter(i => i.id != productId);
    }
    else if (existing) {
        existing.quantity = qty;
        existing.amount = parseFloat(amount);
        existing.discount = parseFloat(mrp * 0.80);
        existing.mrp = parseFloat(mrp);
    }
    else {
        cart.push({
            id: productId,
            name: name,
            quantity: qty,
            mrp: parseFloat(mrp),
            discount: parseFloat(mrp * 0.80),
            amount: parseFloat(amount)
        });
    }

    updateCartDisplay();
}

// =====================================================
// ðŸŸ¢ UPDATE CART DISPLAY (FLOATING CART + MODAL)
// =====================================================
function updateCartDisplay() {
    const total = cart.reduce((s, i) => s + i.amount * i.quantity, 0);
    const count = cart.reduce((s, i) => s + i.quantity, 0);

    document.getElementById("cart-total").textContent = total.toFixed(2);
    document.querySelector(".cart-items-count").textContent = `(${count} items)`;
    document.getElementById("modalSubtotal").textContent = total.toFixed(2);

    updateCartModal();
    updateMinOrderAlert(); // Check minimum order requirement
}

// =====================================================
// ðŸŸ£ UPDATE CART MODAL ITEMS
// =====================================================
function updateCartModal() {

    const cartItems = document.getElementById("cartItems");

    if (cart.length === 0) {
        cartItems.innerHTML = `
            <div class="text-center text-muted py-4">
                <i class="bi bi-cart-x" style="font-size:3rem"></i>
                <p>Your cart is empty</p>
            </div>
        `;
        return;
    }

    cartItems.innerHTML = cart.map(item => `
        <div class="cart-item d-flex justify-content-between align-items-center mb-3 p-3 border rounded">
            <div>
                <h6 class="mb-1">${item.name}</h6>
                <small class="text-muted">
                    MRP: â‚¹${item.mrp} | Discount: â‚¹${item.discount} | Amount: â‚¹${item.amount}
                    <br>Qty: ${item.quantity}
                </small>
            </div>
            <div class="d-flex align-items-center gap-3">
                <span class="fw-bold">â‚¹${(item.amount * item.quantity).toFixed(2)}</span>
                <button class="btn btn-sm btn-outline-danger remove-item" data-id="${item.id}">
                    <i class="bi bi-trash"></i>
                </button>
            </div>
        </div>
    `).join("");

    document.querySelectorAll(".remove-item").forEach(btn => {
        btn.addEventListener("click", function () {
            const id = btn.dataset.id;
            cart = cart.filter(i => i.id != id);

            // Reset qty in desktop table if exists
            const row = document.querySelector(`tr[data-product-id="${id}"] .qty-input`);
            if (row) row.value = 0;

            // Reset qty in mobile card if exists
            const mob = document.querySelector(`.mobile-product-item[data-product-id="${id}"] .qty-input`);
            if (mob) mob.value = 0;

            updateCartDisplay();
        });
    });
}

// =====================================================
// ðŸŸ¡ DESKTOP TABLE HANDLER
// =====================================================
document.addEventListener("DOMContentLoaded", function () {

    document.querySelectorAll(".order-row").forEach(row => {
        const qtyInput = row.querySelector(".qty-input");
        const mrp = parseFloat(row.dataset.mrp);

        const discountEle = row.querySelector(".discount-val");
        const amountEle = row.querySelector(".amount-val");
        const totalEle = row.querySelector(".row-total-val");

        qtyInput.addEventListener("input", function () {
            const qty = parseInt(qtyInput.value) || 0;

            const discount = (mrp * 0.80).toFixed(2);
            const amount = (mrp * 0.20).toFixed(2);
            const total = (amount * qty).toFixed(2);

            discountEle.textContent = discount;
            amountEle.textContent = amount;
            totalEle.textContent = total;

            updateCart(row.dataset.productId, row, qty, amount, mrp);
        });
    });
});

// =====================================================
// ðŸ”µ MOBILE CARD HANDLER (NOW SHOWS FULL BREAKDOWN A1)
// =====================================================
document.addEventListener("DOMContentLoaded", function () {

    document.querySelectorAll(".mobile-product-item").forEach(box => {

        const qtyInput = box.querySelector(".qty-input");
        const mrp = parseFloat(box.dataset.mrp);

        const amountEle = box.querySelector(".amount-val");
        const totalEle = box.querySelector(".row-total-val");

        // Create discount span dynamically for mobile
        if (!box.querySelector(".mobile-discount")) {
            const discountTag = document.createElement("div");
            discountTag.style.color = "#ff5252";
            discountTag.style.fontWeight = "700";
            discountTag.style.marginTop = "4px";
            discountTag.classList.add("mobile-discount");
            box.querySelector(".mobile-info").appendChild(discountTag);
        }

        const discountEle = box.querySelector(".mobile-discount");

        qtyInput.addEventListener("input", function () {
            const qty = parseInt(qtyInput.value) || 0;

            const discount = (mrp * 0.80).toFixed(2);
            const amount = (mrp * 0.20).toFixed(2);
            const total = (amount * qty).toFixed(2);

            discountEle.textContent = `Discount: â‚¹${discount}`;
            amountEle.textContent = `â‚¹${amount}`;
            totalEle.textContent = total;

            updateCart(box.dataset.productId, box, qty, amount, mrp);
        });
    });

    
});

</script>

<script>
// =====================================================
// âš¡ QUICK ORDER SYSTEM
// =====================================================

let currentQuickOrderList = null;
let quickOrderListsCache = null;

// Load quick order lists when modal is opened
document.getElementById('quickOrderModal')?.addEventListener('show.bs.modal', function() {
    loadQuickOrderLists();
});

async function loadQuickOrderLists() {
    try {
        const response = await fetch('/inventory/quick-order-lists/', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]')?.value || ''
            }
        });

        const data = await response.json();

        if (data.success) {
            quickOrderListsCache = data.quick_order_lists;
            displayQuickOrderLists(data.quick_order_lists);
        } else {
            showAlert('Failed to load quick order lists', 'danger');
        }
    } catch (error) {
        console.error('Error loading quick order lists:', error);
        showAlert('Network error. Please try again.', 'danger');
    }
}

function displayQuickOrderLists(lists) {
    const container = document.getElementById('quickOrderListsContainer');
    
    let html = '<div class="quick-order-lists-container">';
    
    lists.forEach(list => {
        const total = list.total || 0;
        html += `
            <div class="quick-order-card" onclick="openQuickOrderDetails(${list.id})">
                <div class="quick-order-card-emoji">${list.emoji}</div>
                <div class="quick-order-card-title">${list.name}</div>
                <div class="quick-order-card-desc">${list.description}</div>
                <div class="quick-order-card-price">â‚¹${total.toFixed(2)}</div>
                <button class="quick-order-card-btn">
                    View & Order <i class="bi bi-arrow-right"></i>
                </button>
            </div>
        `;
    });
    
    html += '</div>';
    container.innerHTML = html;
}

function openQuickOrderDetails(listId) {
    const list = quickOrderListsCache.find(l => l.id === listId);
    if (!list) return;

    currentQuickOrderList = list;

    const modalTitle = document.getElementById('detailsModalTitle');
    const content = document.getElementById('quickOrderDetailsContent');

    modalTitle.innerHTML = `${list.emoji} ${list.name}`;

    let html = `
        <p style="color: #666; margin-bottom: 20px;">${list.description}</p>
        <div class="quick-order-products-list">
    `;

    list.products.forEach(product => {
        html += `
            <div class="quick-order-product-item">
                ${product.image_url ? `<img src="${product.image_url}" alt="${product.name}" class="quick-order-product-image">` : '<div style="width: 80px; height: 80px; background: #e0e0e0; border-radius: 8px; display: flex; align-items: center; justify-content: center;"><i class="bi bi-image" style="font-size: 2rem; color: #999;"></i></div>'}
                <div class="quick-order-product-info">
                    <div class="quick-order-product-name">${product.name}</div>
                    <div class="quick-order-product-category">${product.category}</div>
                    <div class="quick-order-product-price">â‚¹${product.price.toFixed(2)}</div>
                </div>
            </div>
        `;
    });

    html += '</div>';

    html += `
        <div class="quick-order-summary">
            <div class="quick-order-summary-row">
                <span>Total Items:</span>
                <span>${list.products.length}</span>
            </div>
            <div class="quick-order-summary-row">
                <span>Categories:</span>
                <span>${[...new Set(list.products.map(p => p.category))].join(', ')}</span>
            </div>
            <div class="quick-order-summary-total">
                <span>Order Total:</span>
                <span>â‚¹${list.total.toFixed(2)}</span>
            </div>
        </div>
    `;

    content.innerHTML = html;

    // Show details modal
    const detailsModal = bootstrap.Modal.getOrCreateInstance(document.getElementById('quickOrderDetailsModal'));
    detailsModal.show();
}

document.getElementById('proceedQuickOrderCheckout')?.addEventListener('click', async function() {
    if (!currentQuickOrderList) {
        showAlert('Please select a quick order list', 'warning');
        return;
    }

    const loadingOverlay = document.getElementById('diwaliLoadingOverlay');
    loadingOverlay.style.display = 'flex';

    try {
        const response = await fetch('/inventory/quick-order/' + currentQuickOrderList.id + '/checkout/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            },
            body: JSON.stringify({
                list_id: currentQuickOrderList.id,
                products: currentQuickOrderList.products
            })
        });

        const data = await response.json();

        if (data.success && data.ready_for_checkout) {
            // Populate cart with quick order items
            cart = [];
            for (const [productId, item] of Object.entries(data.cart_items)) {
                cart.push({
                    id: parseInt(productId),
                    name: item.name,
                    quantity: item.quantity,
                    amount: item.price
                });
            }

            updateCartDisplay();

            // Close all modals
            bootstrap.Modal.getInstance(document.getElementById('quickOrderDetailsModal'))?.hide();
            bootstrap.Modal.getInstance(document.getElementById('quickOrderModal'))?.hide();

            // Wait a moment then show loading
            setTimeout(() => {
                // Open cart modal to proceed with checkout
                const cartModal = bootstrap.Modal.getOrCreateInstance(document.getElementById('cartModal'));
                cartModal.show();
                
                loadingOverlay.style.display = 'none';
                
                // Scroll to checkout button
                setTimeout(() => {
                    const checkoutBtn = document.getElementById('proceedToCheckout');
                    checkoutBtn?.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 500);
            }, 1500);
        } else if (data.shortfall !== undefined) {
            loadingOverlay.style.display = 'none';
            showAlert(`Minimum order amount is â‚¹${data.minimum_required}. Current: â‚¹${data.current_total.toFixed(2)}. Shortfall: â‚¹${data.shortfall.toFixed(2)}`, 'warning');
        } else {
            loadingOverlay.style.display = 'none';
            showAlert(data.error || 'Error processing quick order', 'danger');
        }
    } catch (error) {
        console.error('Error:', error);
        loadingOverlay.style.display = 'none';
        showAlert('Network error. Please try again.', 'danger');
    }
});

function showAlert(message, type = 'info') {
    // Use existing toast/alert system if available, otherwise use alert
    if (typeof showToast === 'function') {
        showToast(message, type);
    } else {
        alert(message);
    }
}

// =====================================================
// ðŸŸ£ CHECKOUT HANDLER â€“ RESTORED

// =====================================================

const MIN_ORDER_AMOUNT = 3000;

document.addEventListener("DOMContentLoaded", function () {

    const checkoutButton = document.getElementById("proceedToCheckout");
    const checkoutForm = document.getElementById("checkoutForm");

    // Update minimum order alert whenever cart changes
    window.updateMinOrderAlert = function() {
        const currentTotal = parseFloat(document.getElementById('modalSubtotal').innerText) || 0;
        const minOrderAlert = document.getElementById('minOrderAlert');
        const shortfallAmount = document.getElementById('shortfallAmount');
        
        if (currentTotal < MIN_ORDER_AMOUNT) {
            const shortfall = MIN_ORDER_AMOUNT - currentTotal;
            shortfallAmount.innerText = shortfall.toFixed(2);
            minOrderAlert.style.display = 'block';
            checkoutButton.disabled = true;
            checkoutButton.style.opacity = '0.6';
            checkoutButton.style.cursor = 'not-allowed';
            checkoutButton.title = `Add â‚¹${shortfall.toFixed(2)} more items to checkout`;
        } else {
            minOrderAlert.style.display = 'none';
            checkoutButton.disabled = false;
            checkoutButton.style.opacity = '1';
            checkoutButton.style.cursor = 'pointer';
            checkoutButton.title = '';
        }
    };

    checkoutButton.addEventListener("click", async function () {

        // Validate minimum order amount first
        const currentTotal = parseFloat(document.getElementById('modalSubtotal').innerText) || 0;
        if (currentTotal < MIN_ORDER_AMOUNT) {
            const shortfall = MIN_ORDER_AMOUNT - currentTotal;
            alert(`Minimum order amount is â‚¹${MIN_ORDER_AMOUNT}. Please add â‚¹${shortfall.toFixed(2)} more items.`);
            return;
        }

        // Validate form
        if (!checkoutForm.checkValidity()) {
            checkoutForm.classList.add("was-validated");
            return;
        }

        if (cart.length === 0) {
            alert("Your cart is empty!");
            return;
        }

        // Disable button and show loading animation
        checkoutButton.disabled = true;
        const originalButtonText = checkoutButton.innerText;
        checkoutButton.innerText = "Processing...";
        const loadingOverlay = document.getElementById('diwaliLoadingOverlay');
        loadingOverlay.style.display = 'flex';

        // Gather customer data
        const customerData = {
            fullName: document.getElementById('fullName').value,
            email: document.getElementById('email').value,
            phone: document.getElementById('phone').value,
            deliveryAddress: document.getElementById('deliveryAddress').value,
            updateProfile: document.getElementById('updateProfile')?.checked || false
        };

        // Prepare cart items for backend
        const cartItemsObj = {};
        cart.forEach(item => {
            cartItemsObj[item.id] = {
                name: item.name,
                quantity: item.quantity,
                price: item.amount
            };
        });
        
        try {
            const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

            const res = await fetch('/inventory/checkout/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken
                },
                body: JSON.stringify({
                    customerData,
                    cartItems: cartItemsObj
                }),
                credentials: 'same-origin'
            });

            const data = await res.json();

            if (data.success) {
                // Keep loading animation for 2 seconds before showing success
                setTimeout(() => {
                    loadingOverlay.style.display = 'none';
                    showDiwaliSuccess(data.orderSummary.total);

                    cart = [];
                    updateCartDisplay();
                }, 1500);
            } else {
                // Hide loading and restore button
                loadingOverlay.style.display = 'none';
                checkoutButton.disabled = false;
                checkoutButton.innerText = originalButtonText;

                // Handle minimum order error gracefully
                if (data.shortfall !== undefined) {
                    alert(`âŒ Minimum Order Requirement\n\nMinimum order amount: â‚¹${data.minimum_required}\nCurrent total: â‚¹${data.current_total.toFixed(2)}\nShortfall: â‚¹${data.shortfall.toFixed(2)}\n\nPlease add more items to your cart.`);
                } else {
                    alert(data.error || "Checkout failed.");
                }
            }

        } catch (err) {
            console.error(err);
            // Hide loading and restore button
            loadingOverlay.style.display = 'none';
            checkoutButton.disabled = false;
            checkoutButton.innerText = originalButtonText;
            alert("Network error. Try again.");
        }

    });

});

// =====================================================
// ðŸŽ† SUCCESS POPUP
// =====================================================
// ------------------- ðŸŽ‡ Diwali Success Overlay -------------------
function showDiwaliSuccess(total) {

    const overlay = document.createElement('div');
    overlay.className = 'diwali-success-overlay active';

    overlay.innerHTML = `
        <div class="diwali-message-box">
            <div class="diya-glow">ðŸª”</div>
            <h2>Order Placed Successfully!</h2>
            <p>
                Thank you for celebrating Diwali with us ðŸŽ†<br>
                <strong>Order Total:</strong> â‚¹${total.toFixed(2)}
            </p>
            <p class="text-muted mt-2">
                Your confirmation has been sent to your registered email.
            </p>
        </div>
    `;

    document.body.appendChild(overlay);

    launchConfetti();

setTimeout(() => {
    overlay.classList.remove('active');
    overlay.remove();
    location.reload();   // ðŸ”¥ Refresh the page after animation
}, 4000);

}


// ------------------- ðŸŽŠ Confetti Effect -------------------
function launchConfetti() {

    for (let i = 0; i < 80; i++) {

        const confetti = document.createElement('div');
        confetti.style.position = 'fixed';
        confetti.style.top = '-10px';
        confetti.style.left = `${Math.random() * 100}%`;
        confetti.style.width = '8px';
        confetti.style.height = '8px';
        confetti.style.borderRadius = '50%';
        confetti.style.background = ['#ffcc00', '#ff6b35', '#0d6efd', '#28a745'][Math.floor(Math.random() * 4)];
        confetti.style.opacity = Math.random();
        confetti.style.zIndex = 9999;

        document.body.appendChild(confetti);

        const duration = 3 + Math.random() * 3;

        confetti.animate([
            { transform: `translateY(0) rotate(0deg)` },
            { transform: `translateY(${window.innerHeight}px) rotate(${360 * Math.random()}deg)` }
        ], {
            duration: duration * 1000,
            easing: 'ease-out',
            fill: 'forwards'
        });

        setTimeout(() => confetti.remove(), duration * 1000);
    }
}

</script>

{% endblock %}
